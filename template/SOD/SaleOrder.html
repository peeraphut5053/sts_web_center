<link href="./css/ind/SaleOrder.css" rel="stylesheet" type="text/css">
<!--<link href="./css/ind/main.css" rel="stylesheet" type="text/css">-->
<style>
    /*.ui-datepicker-calendar {display: none; }​*/
    #tablePcsPerBndl .table thead tr th {
        text-align: center;
        font-size:16px;
    }
    #tablePcsPerBndl .table tbody tr td {
        text-align: center;
        font-size:16px;
    }
    .select2-container .select2-selection--single {
        border-radius:0px;
        border-top-left-radius: 5px;
        border-bottom-left-radius: 5px;
        height:30px;
        border:solid 1px #cdcdcd;


    }
    #rowXlsInfo{
        background-color:orange;
        color:#FFFFFF;
    }
    .table tr th{
        font-size: 12px;
    }
    .table tr td{
        font-size: 12px;
    }
    .btnLink {
        height: 30px;
        margin-left: 5px;
    }

    a[id*='btnRemove'] {
        height: 30px;
        width: 30px;
        padding-left: 8px;
        padding-top: 2px;
    }

    .table thead th {
        background-color: #3b8aff;
        vertical-align: middle;
        color: #ffffff;
        padding-top: 5px;
        padding-bottom: 5px;
        text-align: center;
        font-size:10px;
    }

    .col-Customer {
        min-height: 70px;
        border: solid 1px #dcdcdc;
        margin-left: 3%;
    }

    .col-po {
        min-height: 70px;
        border: solid 1px #dcdcdc;
    }

    .col-info {
        padding-left: 0px;
    }



    #divCustomerInfo {
        /*        font-size: 14px;
                border: solid 1px #e4e4e4;
                min-height: 65px;
                margin-left: 20px;
                margin-right: 0px;
                border-radius: 10px;*/
    }

    #btnCollapse {
        margin-right: 25px;
        font-size: 14px;
        float: right;
        /*        padding-right: 8px;
                padding-left: 8px;
                margin-top: -5px;*/
    }

    label {
        font-size: 12px;
    }

    .input-group {
        /*        margin-left: 10px;
                margin-right: 10px;*/
    }

    .form-input {
        height: 32px;
    }
    .input-group-addon{
        background-color:#cdcdcd;
        color:#000;
        /*font-weight: bold;*/
    }
    .row-item {
        margin-left: -15px;
        margin-right: -15px;
        margin-top: 10px;
        padding-left: 10px;
        border: solid 1px #cdcdcd;
        background-color: #bdd8f5;
    }
    .panel-heading{
        padding-top:2px;
        padding-bottom:2px;
        font-size:12px;
    }
    .ui-dialog .ui-dialog-titlebar-close {
        position: absolute;
        right: .3em;
        top: 50%;
        width: 21px;
        margin: -10px 0 0 0;
        padding: 1px;
        height: 20px;
    }
    .expandbox{
        padding-left:3px;
        padding-right:3px;
    }
</style>
<div class="row">
    <div id="divCssDynamic">
        <!--    <style>
            .ui-datepicker-calendar {display: none; }​
            </style>-->
    </div>
    <div class="row rowheader">
        <div class="col-6 col-xs-6 col-sm-6 col-md-6 col-lg-6  text-left" style="padding-top:10px;">
            <h6><a href="index.php" > <i class="fas fa-home"></i> Home </a> / <a href="{back_main_link}"> Lists </a> / Create New {force_form_desc}</h6>
            <input type='hidden' id='hdfForceForm' value='{force_form}'>
            <input type='hidden' id='hdfForceCust' value='{force_cust}'>
        </div>
        <div id="divControl" class="col-6 col-xs-6 col-sm-6 col-md-6 col-lg-6  text-right" style="padding-right:0px;padding-bottom:3px;">
            <a href="#" id="btnRefresh" OnClick="location.reload();" class="btn btn-default"><i class="fas fa-sync"></i></a>
            <a id="btnImportEcel" class="btn btn-default"><i class="fas fa-file-excel"></i> Import Excel</a>
            <a href="#" id="btnSave" class="btn btn-default"><i class="fas fa-save" style="color:green;"></i> SAVE</a>
        </div>
    </div>    


    <div class="row " >
        <div class="col-md-6">
            <a style="cursor: pointer;" class="btn btn-default" id="openHead"><i id="signHead" class="fa fa-chevron-circle-right" style="margin-right:5px;"></i>Header</a>
            <a class="btn btn-default"  style="cursor: pointer;"  id="openAdv"><i id="signAdv" class="fa fa-chevron-circle-right" style="margin-right:5px;"></i>More header Field</a>
            <a class="btn btn-default"  style="cursor: pointer;"  id="openEndCust"><i id="signEndCust" class="fa fa-chevron-circle-right" style="margin-right:5px;"></i>End Customer</a>
        </div>
        <div class="col-md-6 text-right">
            <!-- Modal -->

            <a  class="btn btn-default" style="cursor: pointer;"  id="OpenPcsPerBndl"><i class="fa fa-list"></i>&nbsp;Pieces per bundle</a>
        </div>
    </div>
    <div id="headDiv" class="well" {fixDialogStyle1}>
        <div class="row">
            <div class="col-md-6">
                <div class="row" >
                    <div class="col-md-4 text-right">
                        Customer
                    </div>
                    <div class="col-md-8 text-left">
                        <input type="hidden" id="cust_num" value="{cust_num}">
                        {cust_name}
                        <!--<b> <div id="divCustomerName" style="font-weight: bolder;"></div></b>-->
                    </div>

                </div>
                <div class="row" >
                    <div class="col-md-4 text-right">
                        Ship From
                    </div>
                    <div class="col-md-3 text-left">
                        <a id="stsDetail" >{STS_Name}</a>
                    </div>
                    <div class="col-md-1 text-left">
                        To
                    </div>
                    <div class="col-md-4 text-left">
                        <select readonly style="width:100%;" class="form-control" id="selShipTo">
                            <option selected  value="{cust_seq}">{cust_addr1}</option>
                        </select>   
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 text-right">
                        <r>*</r> Shipment date Ex-Mill
                    </div>
                    <div class="col-md-3 text-right">
                        <input type="text" class="form-control" id="txtShipMentFrom" placeholder="select from">     
                    </div>
                    <div class="col-md-1 text-left">
                        To
                    </div>
                    <div class="col-md-4 text-right">
                        <input type="text" class="form-control" id="txtShipMentTo" placeholder="select to">   
                    </div>                    
                </div>
            </div>



            <div class="col-md-6">
                <div class="row text-right">
                    <a id="closeHead"><font color="red"><i class='fa fa-times'></i>&nbsp;Close</font></a>
                </div>
                <div class="row">
                    <div class="col-md-3 text-right">
                        Doc No
                    </div>
                    
                    <div class="col-md-4 text-left">
                        <input type="text" class="form-control expandbox" id="txtDocNo" readonly value="">
                    </div>
                    <div class="col-md-1 text-right">
                        Date
                    </div>
                    <div class="col-md-4 text-left">
                        <input type="text" class="form-control expandbox" id="txtDocDate" readonly value="{doc_date}">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3 text-right">
                        <r>*</r>Po No
                    </div>
                    <div class="col-md-4 text-left">
                        <input type="text" class="form-control expandbox" id="txtPoNum"  value="">
                    </div>
                      <div class="col-md-1 text-right">
                        Date
                    </div>
                    <div class="col-md-4 text-left">
                        <input type="text" class="form-control expandbox" id="txtPoDate" placeholder="select po date">
                    </div>
                </div>
            </div>
        </div>










    </div>

    <div id="adv" class="well" style="display:none;">
        <h4><i class="fa fa-tasks"></i>&nbsp; More Fields
            <label class="pull-right" id = "closeDivAdv" style="color:red;font-size:20px;cursor: pointer;"><i class="fa fa-times"></i>&nbsp;hide</label>  
        </h4>
        <hr style="border-top: dashed 1px #666;">
        <div class="row">
            <div class="col-md-4 text-right">
                Spec
            </div>
            <div class="col-md-8 text-left">
                <input type="text" class="form-control" id="txtSpec">
            </div>

        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                Terms of purchase
            </div>
            <div class="col-md-8 text-left">
                <input type="text" class="form-control" id="txtTerms">
            </div>

        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                Attn
            </div>
            <div class="col-md-8 text-left">
                <input type="text" class="form-control" id="txtAttn">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                Remark
            </div>
            <div class="col-md-8 text-left">
                <input  type="text" class="form-control" id="txtRemark">
            </div>

        </div>
    </div>

    <div id="endCustomerDiv" class="well" style="display:none;">
        <h4><i class="fa fa-users"></i>&nbsp; End customer 
            <label class="pull-right" id = "closeDivEndCust" style="color:red;font-size:20px;cursor: pointer;"><i class="fa fa-times"></i>&nbsp;hide</label>  
        </h4>
        <hr style="border-top: dashed 1px #666;">
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 1 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust1" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 2 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust2" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 3 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust3" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 4 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust4" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 5 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust5" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 6 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust6" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 7 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust7" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 8 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust8" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 9 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust9" class="form-control">
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 text-right">
                End Customer 10 : 
            </div>
            <div class="col-md-8 text-right">
                <input type="text" id="endcust10" class="form-control">
            </div>
        </div>
    </div>
    <div class="row text-center" id="rowXlsInfo" >
        Excel File :  <label id="lblXlsFile"></label>&nbsp;|&nbsp; 
        Excel Sheet : <label id="lblXlsSheet"></label>&nbsp;|&nbsp; 
        <label id="lblMatchStatus"></label>
    </div>
    <div class="row" style="overflow-x:scroll;overflow-y: auto;height:400px;">
        <table class="table table-bordered " id="tableItemsFromFilter">
            <thead>
                <tr>
                    <th rowspan="2"  align="center" style="width:2%;">#</th>
                    <th rowspan="2" colspan="2"  align="center"  style="width:18%;" >Item
                        <a class="btn btn-info "  id="btnShowFilter"><i class="fas fa-search"></i></a>
                    </th>
                    <th rowspan="2"  align="center" style="width:3%;">SIZE</th>
                    <!--<th rowspan="2"  align="center" style="width:3%;">OD (IN.)</th>-->
                    <th rowspan="2"  align="center" style="width:3%;">THEO WEIGHT<br>(LBS/FT)</th>
                    <th rowspan="2"  align="center" style="width:3%;">LENGTH<br>FT)</th>
                    <th rowspan="2"  align="center" style="width:3%;">CATEGORY</th>     
                    <th rowspan="2"  align="center" style="width:3%;">SCHEDULE</th>
                    <th rowspan="2"  align="center" width="5%">PCS PER BNDL</th>
                    <th colspan="4" >ORDER QUANTITY</th>
                    <th rowspan="2" align="center" style="width:3%;">{flag_duty} LO/CY($/MT)</th>
                    <th rowspan="2" align="center" style="width:3%;">{flag_duty} LO/CY($/FT)</th>
                    <th rowspan="2" align="center" style="width:7%;">Ext.Price</th>
                    <th rowspan="2" align="center" style="width:2%;">
                        <!--<a href="#" class="btn btn-success" id="btnAddItem"><i class="fas fa-plus"></i></a>-->
                    </th>
                </tr>
                <tr>
                    <th style="width:3%;">BNDLS</th>
                    <th style="width:3%;">PIECES</th>
                    <th style="width:6%;">{cust_measure}</th>
                    <!--<th style="width:3%;">NET TONS</th>-->
                    <th style="width:6%;">M. TONS</th>
                </tr>
            </thead>
            <!--        </table>
                    <table>-->
            <tbody id="tableItems">

            </tbody>
        </table>
    </div>
    <input type="hidden" id="cust_measure" value="{cust_measure}">

</div>
<div id="divSearchItem"></div>
<div id="divAddPort"></div>
<div id="divImportExcel"></div>
<div id = "tablePcsPerBndl" class="hidden-md hidden-lg hidden-xs hidden-sm">
    <table id="tablePcsPerBndl" class="table table-striped table-condensed"> 
        <thead>
            <tr>
                <th colspan="2">
                    SCH.40&80 
                </th>   
                <th >
                    SCH.10
                </th>
            </tr>
            <tr>
                <th>SIZE</th>
                <th>B'DLE/PCS</th>
                <th>B'DLE/PCS</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1/2</td>
                <td>120</td>
                <td>169</td>
            </tr>
            <tr>
                <td>3/4</td>
                <td>84</td>
                <td>127</td>
            </tr>
            <tr>
                <td>1</td>
                <td>60</td>
                <td>91</td>
            </tr>
            <tr>
                <td>1 1/4</td>
                <td>42</td>
                <td>61</td>
            </tr>
            <tr>
                <td>1 1/2</td>
                <td>36</td>
                <td>44</td>
            </tr>
            <tr>
                <td>2</td>
                <td>26</td>
                <td>37</td>
            </tr>
            <tr>
                <td>2 1/2</td>
                <td>18</td>
                <td>29</td>
            </tr>
            <tr>
                <td>3</td>
                <td>14</td>
                <td>25</td>
            </tr>
            <tr>
                <td>3 1/2</td>
                <td>12</td>
                <td>19</td>
            </tr>
            <tr>
                <td>4</td>
                <td>10</td>
                <td>19</td>
            </tr>
            <tr>
                <td>5</td>
                <td>7</td>
                <td>10</td>
            </tr>
            <tr>
                <td>6</td>
                <td>7</td>
                <td>10</td>
            </tr>
            <tr>
                <td>8</td>
                <td>5</td>
                <td>5</td>
            </tr>
        </tbody>
    </table>
</div>



<input type="hidden" id="hdFlagInputType" value="">
<script type="text/javascript" src="./js/ind/SaleOrder.js"></script>

<script type="text/javascript">
                LinkCustSyteline();
                function LinkCustSyteline() {
                    var cust_num = "{cust_num}";
                    //                    console.log(cust_num);
                    //                                        },
                    //                                        error: function (xhr, status, error) {
                    //                                            console.log(xhr.responseText);
                    //                                        },
                    //                    }
                    //                    );
                }


                $("#rowXlsInfo").hide();
                $('#txtShipMentFrom,#txtShipMentTo').click(function () {

                    $('#divCssDynamic').append('<style>.ui-datepicker-calendar {display: none; }​</style>');
                });
                $("#txtPoDate").click(function () {
                    $('#divCssDynamic').empty();
                });
                $('#txtShipMentFrom,#txtShipMentTo').datepicker({
                    changeMonth: true,
                    changeYear: true,
                    dateFormat: 'mm/yy',
                    showButtonPanel: true,
                    onClose: function () {
                        var iMonth = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
                        var iYear = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
                        $(this).datepicker('setDate', new Date(iYear, iMonth, 1));
                    },
                    beforeShow: function () {
                        if ((selDate = $(this).val()).length > 0)
                        {
                            iYear = selDate.substring(selDate.length - 4, selDate.length);
                            iMonth = jQuery.inArray(selDate.substring(0, selDate.length - 5), $(this).datepicker('option', 'monthNames'));
                            $(this).datepicker('option', 'defaultDate', new Date(iYear, iMonth, 1));
                            $(this).datepicker('setDate', new Date(iYear, iMonth, 1));
                        }
                    }
                });


                $("#txtPoDate").datepicker({
                    dateFormat: 'yy-mm-dd',
                });
                //                                $("#txtShipMentFrom,#txtShipMentTo").datepicker({
                //                                    dateFormat: 'mm/yy',
                //                                });
                //                                $("#txtShipMentTo").datepicker({
                //                                    dateFormat: 'mm/yy',
                //                                    changeMonth: true,
                //                                    changeYear: true,
                //                                    changeDay : false ;
                //                                    showButtonPanel: true,
                //                                });

                //                                function OpenModalAddPort() {
                //                                    var cust_name = $("#divCustomerName").text();
                //                                    $('#divAddPort').dialog({
                //                                        modal: true,
                //                                        autoOpen: true,
                //                                        show: 'fade',
                //                                        width: 400,
                //                                        height: 300,
                //                                        title: ":: Add Port "
                //                                    })
                //                                            .load("././module/SOD/z_dialogPortAdd.php", {
                //                                                "cust_name": cust_name
                //                                            });
                //                                }


                $("#stsDetail").click(function () {
                    $.confirm({
                        theme: 'modern', // 'material', 'bootstrap',
                        title: 'Ship From Details',
                        content: '<b>{STS_Fullname}</b><br>{STS_Addr}<br>Tel : {STS_Tel}<br>Fax : {STS_Fax}',
                        buttons: {
                            confirm: function () {

                            }
                        }
                    });
                });
                var InitCustomerLink = "{Customer_link}";
                var cust_num = "{cust_num}";
                //                                alert(cust_num);
                //                                GetShipPort();
                function GetShipPort(firstSelected) {
                    $("#loading").show();
                    $("#selShipTo").empty();
                    $.ajax({
                        url: "./module/SOD/CustomerSaleOrder.php",
                        type: 'post',
                        data: {
                            ajax: 'true',
                            action: "GetPortToDropDown",
                        },
                        success: function (data) {
                            var items = [];
                            var GetArray = new Array(data);
                            items.push({
                                "id": "",
                                "text": ""
                            });
                            $.each(data, function (key, value) {
                                items.push({
                                    "id": key,
                                    "text": value
                                });
                            });
                            $('#selShipTo').select2({
                                data: items
                            });
                            $('#selShipTo').val(firstSelected).trigger('change');
                            $("#loading").hide();
                        },
                        error: function (xhr, status, error) {
                            $("#debug").html(xhr.responseText);
                        },
                        dataType: "json"
                    });
                }
                //                                if (InitCustomerLink == "") {
                //                                    $("#NoCustomerLink").show();
                //                                    $("#HasCustomerLink").hide();
                //                                    $("#divControl").hide();
                //                                } else {
                //                                    $("#NoCustomerLink").hide();
                //                                    $("#HasCustomerLink").show();
                //
                //                                 
                //                                }
                //                                GetCustomer();
                GetNewDocNo();
                $("#btnShowFilter").click(function () {

                    if ($("#divImportExcel").val() == "excel") {
                        $.alert({
                            title: ":: Warning",
                            content: "Data mode is [excel] please reload page ",
                            //                                            width: screen.width - 100,
                            height: 100,
                        });
                    } else {
                        $('#divSearchItem').dialog({
                            modal: true,
                            autoOpen: true,
                            show: 'fade',
                            width: screen.width - 100,
                            height: screen.height - 100,
                            top: 0,
                            //                                        buttons: [
                            //                                            {
                            //                                                text: "Close",
                            //                                                click: function () {
                            //                                                    $(this).dialog("close");
                            //                                                }
                            //                                            }
                            //                                        ],
                            title: ":: Select Item "
                        })
                                .load("././module/SOD/z_dialogSelectItemSyteLine.php"
                                        );
                    }
                });
                $("#btnImportEcel").click(function () {
                    if ($("#divImportExcel").val() == "normal") {
                        $.alert({
                            title: ":: Warning",
                            content: "Data mode is [item selector] please reload page "
                        });
                    } else {
                        //                                        var cust_measure = $("#cust_measure").val();
                        $('#divImportExcel').dialog({
                            modal: true,
                            autoOpen: true,
                            show: 'fade',
                            width: screen.width - 100,
                            height: 600,
                            top: 0,
                            title: ":: Import Excel "
                        })
                                .load("././module/SOD/z_dialogImportExcel.php"
                                        );
                    }
                });




                $("#btnSave").click(function () {
                    var txtPoNum = $("#txtPoNum").val();
                    var txtDocNo = $("#txtDocNo").val();
                    var txtPoDate = $("#txtPoDate").val();
                    var ShipExFrom = $("#txtShipMentFrom").val();
                    var ShipExTo = $("#txtShipMentTo").val();
                    var ShipToText = $("#selShipTo option:selected").text();
                    var ShipTo = $("#selShipTo").val();
                    var ExDateFrom = $("#txtShipMentFrom").val();
                    var ExDateTo = $("#txtShipMentTo").val();
                    var txtSpec = $("#txtSpec").val();
                    var txtTerms = $("#txtTerms").val();
                    var txtAttn = $("#txtAttn").val();
                    var txtShipMent = $("#txtShipMent").val();
                    var txtRemark = $("#txtRemark").val();
                    var endcust1 = $("#endcust1").val();
                    var endcust2 = $("#endcust2").val();
                    var endcust3 = $("#endcust3").val();
                    var endcust4 = $("#endcust4").val();
                    var endcust5 = $("#endcust5").val();
                    var endcust6 = $("#endcust6").val();
                    var endcust7 = $("#endcust7").val();
                    var endcust8 = $("#endcust8").val();
                    var endcust9 = $("#endcust9").val();
                    var endcust10 = $("#endcust10").val();
                    var xls_file = $("#lblXlsFile").text().trim();
                    var xls_sheet = $("#lblXlsSheet").text().trim();
                    var sl_cust_num = "{cust_num_sl}";
                    var sl_co_no = $("#lblCoNo").text().trim();
                    //                                    var cust_num = "";
                    //                                    var get_cust_num ="" ;

                    var txtGridItem = "";
                    var txtGridItemDesc = "";
                    var txtGridSize = "";
                    var txtGridTW = "";
                    var txtGridLEN = "";
                    var txtGridLENTOTAL = "";
                    var txtGridCATE = "";
                    var txtGridSCHED = "";
                    var txtGridPCSPERBNDL = "";
                    var txtGridBNDLS = "";
                    var txtGridPIECES = "";
                    var txtGridNETTONS = "";
                    var txtGridMTONS = "";
                    var txtGridCFRMT = "";
                    var txtGridCFRFT = "";
                    var txtGridEXT = "";
                    var txtGridLot = "";
                    var txtUnitWeight = "";
                    //                                    var txtSelItemSL = "";

                    var ErrCoount = 0;
                    var ErrMsg = "Form validation \n";
                    if (ShipTo == "") {
                        ErrCoount++;
                        ErrMsg = ErrMsg + "<br>- Port not select \n ";
                    }
                    if (txtPoDate == "") {
                        ErrCoount++;
                        ErrMsg = ErrMsg + "<br>- PO Date not select \n ";
                    }

                    if (ErrCoount > 0) {
                        $.alert({
                            title: 'Warning!',
                            content: ErrMsg,
                        });

                        return false;
                    } else {

                        //=========== Pass Valid ===============//                  
                        $.confirm({
                            title: 'Do you want to save ? ',
                            content: "",
                            buttons: {
                                confirm: function () {
                                    var x = 0;
                                    var CountRow = $("td[id^='rowItem']").length;
                                    var doc_no = $("#txtDocNo").val();
                                    if (CountRow == 0) {
                                        $.alert({
                                            title: 'Warning!',
                                            content: 'No data save',
                                        });
                                    } else {

                                        $("input[id^='rowLot']").each(function () {
                                            x++;
                                            txtGridLot += $(this).val().trim() + "!!";
                                            //                                                            txtGridLot.push($(this).val().trim());
                                        });
                                        $("h6[id^='txtItem_']").each(function () {
                                            txtGridItem += $(this).text().trim() + "!!";
                                            //                                                            txtGridItem.push($(this).text().trim());
                                        });
                                        $("input[id^='rowDesc_']").each(function () {
                                            txtGridItemDesc += $(this).val().trim() + "!!";
                                            //                                                            txtGridItemDesc.push($(this).val().trim());
                                        });
                                        $("input[id^='UnitWeight_']").each(function () {
                                            txtUnitWeight += $(this).val().trim() + "!!";
                                            //                                                            txtUnitWeight.push($(this).val().trim());
                                        });
                                        $("td[id^='rowSIZE_']").each(function () {
                                            txtGridSize += $(this).text().trim() + "!!";
                                            //                                                            txtGridSize.push($(this).text().trim());
                                        });
                                        $("td[id^='rowTW']").each(function () {
                                            txtGridTW += $(this).text().trim() + "!!";
                                            //                                                            txtGridTW.push($(this).text().trim());
                                        });
                                        $("td[id^='rowUL_']").each(function () {
                                            txtGridLEN += $(this).text().trim() + "!!";
                                            //                                                            txtGridLEN.push($(this).text().trim());
                                        });
                                        $("td[id^='rowCATE']").each(function () {
                                            txtGridCATE += $(this).text().trim() + "!!";
                                            //                                                            txtGridCATE.push($(this).text().trim());
                                        });
                                        $("td[id^='rowSCHED_']").each(function () {
                                            txtGridSCHED += $(this).text().trim() + "!!";
                                            //                                                            txtGridSCHED.push($(this).text().trim());
                                        });
                                        $("td[id^='rowPCSPERBNDL_']").each(function () {
                                            txtGridPCSPERBNDL += $(this).text().trim() + "!!";
                                            //                                                            txtGridPCSPERBNDL.push($(this).text().trim().replace(',', ''));
                                        });
                                        $("td[id^='rowBNDL_']").each(function () {
                                            txtGridBNDLS += $(this).text().trim() + "!!";
                                            //                                                            txtGridBNDLS.push($(this).text().trim().replace(',', ''));
                                        });
                                        $("td[id^='rowPCS_']").each(function () {
                                            txtGridPIECES += $(this).text().trim().replace(',', '') + "!!";
                                            //                                                            txtGridPIECES.push($(this).text().trim().replace(',', ''));
                                        });
                                        $("td[id^='rowTTLEN_']").each(function () {
                                            txtGridLENTOTAL += $(this).text().trim().replace(',', '') + "!!";
                                            //                                                            txtGridLENTOTAL.push($(this).text().trim().replace(',', ''));
                                        });
                                        $("td[id^='rowNTONS_']").each(function () {
                                            txtGridNETTONS += $(this).text().trim().replace(',', '') + "!!";
                                            //                                                            txtGridNETTONS.push($(this).text().trim().replace(',', ''));
                                        });
                                        $("td[id^='rowMTONS_']").each(function () {
                                            txtGridMTONS += $(this).text().trim().replace(',', '') + "!!";
                                            //                                                            txtGridMTONS.push($(this).text().trim().replace(',', ''));
                                        });
                                        $("td[id^='rowCFRMT']").each(function () {
                                            txtGridCFRMT += $(this).text().trim().replace(',', '') + "!!";
                                            //                                                            txtGridCFRMT.push($(this).text().trim().replace(',', ''));
                                        });
                                        $("td[id^='rowCFRFT_']").each(function () {
                                            txtGridCFRFT += $(this).text().trim().replace(',', '') + "!!";
                                            //                                                            txtGridCFRFT.push($(this).text().trim().replace(',', ''));
                                        });
                                        $("td[id^='rowEXTPRICE_']").each(function () {
                                            txtGridEXT += $(this).text().trim().replace(',', '') + "!!";
                                            //                                                            txtGridEXT.push($(this).text().trim().replace(',', ''));
                                        });


                                        //                                                        console.log(txtGridItem);
                                        var head_data =
                                                cust_num + "!!" //0
                                                + txtPoNum + "!!" //1
                                                + txtDocNo + "!!"//2
                                                + txtPoDate + "!!"//3
                                                + ShipExFrom + "!!"//4
                                                + ShipExTo + "!!"//5
                                                + ShipTo + "!!"//6
                                                + ShipToText + "!!"//7
                                                + ExDateFrom + "!!"
                                                + ExDateTo + "!!"
                                                + txtSpec + "!!" //10
                                                + txtAttn + "!!"
                                                + txtTerms + "!!"
                                                + txtRemark + "!!"
                                                + endcust1 + "!!"
                                                + endcust2 + "!!" //15
                                                + endcust3 + "!!"
                                                + endcust4 + "!!"
                                                + endcust5 + "!!"
                                                + endcust6 + "!!"
                                                + endcust7 + "!!" //20
                                                + endcust8 + "!!"
                                                + endcust9 + "!!"
                                                + endcust10 + "!!"
                                                + xls_file + "!!"
                                                + xls_sheet + "!!"
                                                + sl_co_no + "!!"
                                                + sl_cust_num;
                                        $.ajax({
                                            url: "./module/SaleOrder.php",
                                            type: 'post',
                                            dataType: "json",
                                            data: {
                                                ajax: 'true',
                                                action: "SavePO",
                                                head_data: head_data,
                                                doc_no: doc_no,
                                                category: txtGridCATE.substring(0, txtGridCATE.length - 2),
                                                lot: txtGridLot.substring(0, txtGridLot.length - 2),
                                                item: txtGridItem.substring(0, txtGridItem.length - 2),
                                                item_desc: txtGridItemDesc.substring(0, txtGridItemDesc.length - 2),
                                                size: txtGridSize.substring(0, txtGridSize.length - 2),
                                                tw: txtGridTW.substring(0, txtGridTW.length - 2),
                                                length: txtGridLEN.substring(0, txtGridLEN.length - 2),
                                                length_total: txtGridLENTOTAL.substring(0, txtGridLENTOTAL.length - 2),
                                                sched: txtGridSCHED.substring(0, txtGridSCHED.length - 2),
                                                pcs_per_bndl: txtGridPCSPERBNDL.substring(0, txtGridPCSPERBNDL.length - 2),
                                                bndls: txtGridBNDLS.substring(0, txtGridBNDLS.length - 2),
                                                pieces: txtGridPIECES.substring(0, txtGridPIECES.length - 2),
                                                unit_weight: txtUnitWeight.substring(0, txtUnitWeight.length - 2),
                                                nettons: txtGridNETTONS.substring(0, txtGridNETTONS.length - 2),
                                                mtons: txtGridMTONS.substring(0, txtGridMTONS.length - 2),
                                                cfrmt: txtGridCFRMT.substring(0, txtGridCFRMT.length - 2),
                                                cfrft: txtGridCFRFT.substring(0, txtGridCFRFT.length - 2),
                                                ext_price: txtGridEXT.substring(0, txtGridEXT.length - 2),
                                                //                                                                txtSelItemSL : txtSelItemSL.substring(0, txtSelItemSL.length - 2),
                                            },
                                            success: function (data) {
                                                console.log(data);

                                                $.confirm({
                                                    title: ':: ' + doc_no + ' :: ',
                                                    content: " SAVE COMPLETE ",
                                                    buttons: {
                                                        confirm: function () {
                                                            var Url = 'http://' + document.location.hostname;
                                                            var UrlPort = document.location.port;

                                                            var UrlAndPort = Url + ':' + UrlPort + '/sts_web_center/?SOD/SaleOrderView&doc_no=' + doc_no;

                                                            window.location.href = UrlAndPort;
                                                        },
                                                    }
                                                });
                                            },
                                            error: function (xhr, status, error) {
                                                console.log(xhr.responseText);
                                                $("#debug").html(xhr.responseText);
                                            },
                                        });
                                    }
                                },
                                cencel: function () {

                                },
                            }
                        });


                    }
                });

                $("#loading").hide();


                function RemoveThis(CountGridRow) {
                    $("#rowIndex_" + CountGridRow).remove();
                }
                function RemoveLot(thisId) {
                    var splitId = thisId.split("_");
                    var lot = splitId[1];
                    $("#tbLot_" + lot).parents("tr").remove();
                }
                //                                function GetCustomer() {
                //                                    var force_cust = $("#hdfForceCust").val();
                //
                //                                    AjaxPage = "/SOD/CustomerSaleOrder";
                //                                    AjaxAction = "GetCustomerInfo";
                //
                //                                    $.ajax({
                //                                        url: "./module/" + AjaxPage + ".php",
                //                                        type: 'post',
                //                                        data: {
                //                                            ajax: 'true',
                //                                            action: AjaxAction,
                //                                            p_cust_num: force_cust
                //                                        },
                //                                        success: function (data) {
                ////                                            console.log(data);
                //                                            if (data.state == 0) {
                ////                            alert(data.msg);
                //                                                var Url = 'http://' + document.location.hostname;
                //                                                var UrlPort = document.location.port;
                //                                                var UrlAndPort = Url + ':' + UrlPort + '/sts_web_center';
                //                                                window.location.href = UrlAndPort;
                //                                            } else {
                //                                                $("#divCustomerName").html(data.name);
                //                                                $("#divCustomerAddr").html(data.addr);
                //                                                $("#divCustomerTel").html(data.tel);
                //                                                $("#divCustomerFax").html(data.fax);
                //                                            }
                //                                        },
                //                                        error: function (xhr, status, error) {
                //                                            $("#debug").html(xhr.responseText);
                //                                        },
                //                                        dataType: "json"
                ////  });
                //                                    });
                //                                }
                function GetNewDocNo() {
                    AjaxPage = "SaleOrder";
                    AjaxAction = "GetNewDocNo";
                    $.ajax({
                        url: "./module/" + AjaxPage + ".php",
                        type: 'post',
                        data: {
                            ajax: 'true',
                            action: AjaxAction
                        },
                        success: function (data) {
                            $("#txtDocNo").val(data.trim());
                        },
                        error: function (xhr, status, error) {
                            $("#debug").html(xhr.responseText);
                        },
                    });

                }



                function CalSummary() {
                    $("#rowMainSummary").empty();
                    var SumBNDL = 0;
                    var SumPCS = 0;
                    var SumLEN = 0;
                    var SumMTONS = 0;
                    var SumCFRMT = 0;
                    var SumCFRFT = 0;
                    var SumEXT = 0;
                    $("td[id^='rowBNDL_']").each(function () {
                        SumBNDL = parseFloat(SumBNDL) + parseFloat($(this).text().trim().replace(',', ''));
                    });
                    $("td[id^='rowPCS_']").each(function () {
                        SumPCS = parseFloat(SumPCS) + parseFloat($(this).text().trim().replace(',', ''));
                    });
                    $("td[id^='rowTTLEN_']").each(function () {
                        SumLEN = parseFloat(SumLEN) + parseFloat($(this).text().trim().replace(',', ''));
                    });
                    $("td[id^='rowMTONS_']").each(function () {
                        SumMTONS = parseFloat(SumMTONS) + parseFloat($(this).text().trim().replace(',', ''));
                    });
                    $("td[id^='rowCFRMT_']").each(function () {
                        if ($(this).text().trim() != "") {
                            SumCFRMT = parseFloat(SumCFRMT) + parseFloat($(this).text().trim().replace(',', ''));
                        }
                    });
                    $("td[id^='rowCFRFT_']").each(function () {
                        if ($(this).text().trim() != "") {
                            SumCFRFT = parseFloat(SumCFRFT) + parseFloat($(this).text().trim().replace(',', ''));
                        }

                    });
                    $("td[id^='rowEXTPRICE_']").each(function () {
                        SumEXT = parseFloat(SumEXT) + parseFloat($(this).text().trim().replace(',', ''));
                    });

                    var row = "<tr id='rowMainSummary'>";
                    row += "<td colspan='8' class='text-right'>Total : </td>";
                    row += "<td class='text-right' id='SumBNDL' style='font-weight:bold;'>" + addCommas(SumBNDL.toFixed(2)) + "</td>";
                    row += "<td class='text-right' id='SumPCS' style='font-weight:bold;'>" + addCommas(SumPCS.toFixed(2)) + "</td>";
                    row += "<td class='text-right' id='SumLEN' style='font-weight:bold;'>" + addCommas(SumLEN.toFixed(2)) + "</td>";
                    row += "<td class='text-right' id='SumMTONS' style='font-weight:bold;'>" + addCommas(SumMTONS.toFixed(2)) + "</td>";
                    row += "<td class='text-right' id='SumCFRMT' st style='font-weight:bold;'>" + addCommas(SumCFRMT.toFixed(2)) + "</td>";
                    row += "<td class='text-right' id='SumCFRFT' style='font-weight:bold;'>" + addCommas(SumCFRFT.toFixed(2)) + "</td>";
                    row += "<td class='text-right' id='SumEXT'  colspan='2' class='text-right' style='font-weight:bold;'>" + addCommas(SumEXT.toFixed(2)) + "</td>";
                    row += "</tr>";
                    $("#tableItems").append(row);

                }
                $("#openAdv").click(function () {
                    $("#adv").toggle();
                    $("#signEndCust").toggleClass('fa-chevron-circle-up fa-chevron-circle-right')

                });

                $("#closeDivAdv").click(function () {
                    $("#adv").toggle();
                    $("#signEndCust").toggleClass('fa-chevron-circle-up fa-chevron-circle-right')
                });


                $("#openEndCust").click(function () {
                    $("#endCustomerDiv").toggle();
                    $("#signEndCust").toggleClass('fa-chevron-circle-up fa-chevron-circle-right')

                });
                $("#closeDivEndCust").click(function () {
                    $("#endCustomerDiv").toggle();
                    $("#signEndCust").toggleClass('fa-chevron-circle-up fa-chevron-circle-right')
                });
                $("#openHead").click(function () {
                    $("#headDiv").toggle();
                    //                                    
                    $("#signHead").toggleClass('fa-chevron-circle-up fa-chevron-circle-right')
                });
                $("#closeHead").click(function () {
                    $("#headDiv").toggle();
                    $("#signHead").toggleClass('fa-chevron-circle-up fa-chevron-circle-right')
                });

                $("#OpenPcsPerBndl").click(function () {
                    $.alert({
                        title: ":: PIECES PER BUNDLE ",
                        content: $("#tablePcsPerBndl").html(),
                        //                                            width: screen.width - 100,
                        //                                            height: 200,
                    });
                    //    $("#PcsPerBndl").append("body");
                    //    $("#PcsPerBndl").modal("show");
                });
                //                                $("#MatchItem").click(function () {
                //                                    MatchItemSyteline();
                //                                });
                //                                function MatchItemSyteline() {
                //                                    var spinner = "<i class='fa fa-spinner fa-spin'></i>&nbsp;Matching..";
                //                                    var CATE = "";
                //                                    var SCHED = "";
                //                                    var NPS = "";
                //                                    var GRADE = "";
                //                                    var TmpRow = "" ;
                //                                    $("h6[id^=txtDesc_]").each(function () {
                //                                        $(this).html(spinner);
                //                                        $("#lblMatchStatus").css({"color": "red"});
                //                                        $("#lblMatchStatus").html(spinner);
                //                                        TmpRow = $(this).attr("id").split("_")[1] ;
                //                                        NPS = $("#rowSIZE_"+TmpRow).text().trim();
                //                                        SCHED = $("#rowSCHED_"+TmpRow).text().trim();
                //                                        CATE = $("#rowCATE_"+TmpRow).text().trim();
                //                                      //  console.log("matching : NPS : " +NPS + " SCHED : " + SCHED  + " CATE : " + CATE + " "  );
                //                                        $.ajax({
                //                                            url: "./module/ItemSyteline.php",
                //                                            type: 'post',
                //                                            dataType: "JSON" ,
                //                                            data: {
                //                                                ajax: "true",
                //                                                action: "MatchItem",
                //                                                CATE: CATE,
                //                                                SCHED: SCHED,
                //                                                NPS: NPS,
                //                                                GRADE: GRADE,
                //                                            },
                //                                            success: function (data) {
                ////                                                console.log(data);
                //                                                $(this).html("found " + data.length);
                //                                                
                //                                            },
                //                                            error: function (xhr, status, error) {
                //                                                $("#debug").html(xhr.responseText);
                //                                            },
                //                                        });
                //                                    });
                //
                ////                                    $("#lblMatchStatus").css({"color": "green"});
                ////                                    $("#lblMatchStatus").html("Matching Complete");
                //                                }
</script>
