<style>
  .col-search {
    padding-left: 3px;
    padding-right: 3px;
  }

  /*    table.dataTable thead .sorting:after,
          table.dataTable thead .sorting:before,
          table.dataTable thead .sorting_asc:after,
          table.dataTable thead .sorting_asc:before,
          table.dataTable thead .sorting_asc_disabled:after,
          table.dataTable thead .sorting_asc_disabled:before,
          table.dataTable thead .sorting_desc:after,
          table.dataTable thead .sorting_desc:before,
          table.dataTable thead .sorting_desc_disabled:after,
          table.dataTable thead .sorting_desc_disabled:before {
              bottom: .5em;
          }*/
  .table thead th {
    text-align: center;
  }

  .col-flt-page {
    padding-top: 10px;
    font-weight: bold;
  }

  #tblReport tbody tr td a {
    cursor: pointer;
  }

  table.dataTable.fixedHeader-floating,
  table.dataTable.fixedHeader-locked {
    background-color: white;
    margin-top: 50px !important;
    margin-bottom: 0 !important;
  }

  @media print {
    table th:nth-child(0) {
      width: 200px;
      word-break: break-all;
      white-space: pre-line;
    }

    table td:nth-child(0) {
      width: 200px;
      word-break: break-all;
      white-space: pre-line;
    }
  }

  .text-header {
    font-weight: bold;
    font-size: 20px;
  }

  .text-wrap {
    white-space: normal;
  }

  .width-200 {
    width: 200px;
  }

  input[type="checkbox"] {
    margin-left: 5px;
    margin-right: 5px;
  }

  /*
      .cb_lb{
          margin-top:-5px;
      }*/
  .item-center {
    display: flex;
    justify-content: center;
  }
</style>
<div class="row">
  <h4 class="text-header text-center">รายงานบัญชีแยกประเภท</h4>
</div>
<div class="row item-center col-xs-12">
  <div class="row col-xs-2">
    <div class="input-group">
      <div class="input-group-addon">Year</div>
      <select class="form-control" id="selYear"></select>
    </div>
  </div>
  <div class="row col-xs-2">
    <div class="input-group">
      <div class="input-group-addon">Start Month</div>
      <select class="form-control" id="selMonth"></select>
    </div>
  </div>
  <div class="row col-xs-2">
    <div class="input-group">
      <div class="input-group-addon">End Month</div>
      <select class="form-control" id="selMonth2"></select>
    </div>
  </div>
  <div class="col-lg-1 col-md-1 col-sm-6 col-xs-6 text-left">
    <button class="btn btn-info" id="btnSearch">
      <i class="fa fa-search"></i>&nbsp; Search
    </button>
  </div>
  <div class="col-lg-1 col-md-1 col-sm-6 col-xs-6 text-left">
    <button class="btn btn-success" id="btnReport">
      รายงานของคงเหลือประจำงวด
    </button>
    <button type="button" class="btn btn-primary  mt-4" id="btnSave" onclick="btnSave(1)">รายงานการเคลื่อนไหวของวัตถุดิบ</button>
    <button type="button" class="btn btn-warning  mt-4" id="btnSave2" onclick="btnSave(2)">รายงานแบบสรุป</button>
  </div>
</div>

<div class="row" id="rowResultTable">
  <table class="table table-condensed table-bordered table-striped" width="100%" id="tblReport">
    <thead>
      <tr>
        <th class="bg-gray">ลำดับที่</th>
        <th class="bg-gray">วันนำเข้า/ส่งออก</th>
        <th class="bg-gray">วันนำเข้าคลังฯ</th>
        <th class="bg-gray">เลขที่ใบขนฯ/ใบขนฯโอนย้าย</th>
        <th class="bg-gray">ประเภทรายการ</th>
        <th class="bg-gray">ยอดยกมา</th>
        <th class="bg-gray">นำเข้า</th>
        <th class="bg-gray">ส่งออก</th>
        <th class="bg-gray">ส่งออก</th>
        <th class="bg-gray">ยอดคงเหลือ</th>
      </tr>
    </thead>
    <!--        <tbody id="tblReportList">
                      <tr><td align="center" colspan="12">.... No item search ....</td></tr>
     </tbody>-->
  </table>
</div>
<script type="text/javascript">

  moment.locale("th");
  
  $("#btnSearch").click(function () {
    ReportItemSearch();
  });

  GetYearMonth("selYear", "selMonth");
  GetYearMonth("selYear", "selMonth2");

  $("#StartDate_Moving,#EndDate_Moving").datepicker({
      dateFormat: "yy-mm-dd",
      changeMonth: true,
      changeYear: true,
  });

  $("#btnRemove").click(function () {
    $("#tblReport").DataTable().clear().destroy();
  });

  function ReportItemSearch() {
    var OldHtml = $("#btnSearch").html();
    var Year = $("#selYear").val();
    var Month = $("#selMonth").val();
    var Month2 = $("#selMonth2").val();

    // get first day of month and last day of month use moment.js
    var StartDate = moment(Year + "-" + Month + "-01").format("YYYY-MM-DD");
    var EndDate = moment(Year + "-" + Month2 + "-01")
      .endOf("month")
      .format("YYYY-MM-DD");

    if (
      (StartDate != "" && EndDate == "") ||
      (StartDate == "" && EndDate != "")
    ) {
      $.alert("กรุณาเลือกวันที่เริ่มต้นและสิ้นสุดให้ครบถ้วน");
      return false;
    }

    if (StartDate == "" && EndDate == "") {
      $.alert("กรุณากรอกข้อมูลอย่างน้อย 1 ช่อง");
      return false;
    } else {
      $("#btnSearch").html("<i class='fa fa-spinner fa-spin'></i>");
      $("#tblReport").loading();
      $("#tblReport tfoot").remove();
      $.ajax({
        type: "POST",
        url: "././module/RPT_STS_CUSTOM_MAINRPT_ACCT/data.php",
        dataType: "json",
        beforeSend: function () {
          $("#btnSearch").html("<i class='fa fa-spinner fa-spin'>");
        },
        data: {
          load: "ajax",
          StartDate: StartDate,
          EndDate: EndDate,
        },
        success: function (data) {

          const typeTwo = data.filter(item => item.doc_type === 2);

          let totalOut = typeTwo.reduce((acc, cur) => {
            return acc + Number(cur.in_value);
          }, 0);


          let accm = Number(data[0].accum);
          let newData = [];

          for (let i = 0; i < data.length; i++) {
            var total;
            if (i === 0) {
              total = accm;
            }

            let item = data[i];

            if (item.doc_type === 1) {
              total -= Number(item.out_value_H001);

            } else {
              total += Number(item.in_value);
            }

            newData.push({
              ...item,

              date_stock: item.date_stock === null ? "" : item.date_stock.date,
              total: addCommas(Math.floor(total * 100) / 100),
            });
          }

          $("#tblReport").DataTable().clear();
          $("#tblReport").append(
            "<tfoot><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tfoot>"
          );
          $("#tblReport").dataTable({
            aaData: newData,
            paging: false,
            fixedHeader: true,
            destroy: true,
            processing: true,
            scrollY: "65vh",
            scrollCollapse: true,
            scrollX: true,
            select: true,
            columns: [
              {
                targets: 0, // คอลัมน์ที่จะแสดง index
                data: null,
                className: "text-center",
                render: function (data, type, row, meta) {
                  return meta.row + 1; // แสดงลำดับแถว +1 เนื่องจาก index เริ่มที่ 0
                },
              },
              {
                data: "date_in.date",
                className: "text-center",
                render: function (data, type, row, meta) {
                  return data?.substring(0, 10);
                },
              },
              {
                data: "date_stock",
                className: "text-center",
                render: function (data, type, row, meta) {
                  return data.substring(0, 10);
                },
              },
              {
                data: "doc_no",
                className: "text-center",
              },
              {
                data: "doc_type",
                className: "text-center",
              },
              {
                data: "accum",
                className: "text-center",
                "render": function (data, type, row, meta) {
                  var ret = Math.floor(data * 100) / 100;
                  var ret = addCommas(ret);
                  return ret;
                }
              },
              {
                data: "in_value",
                className: "text-center",
                "render": function (data, type, row, meta) {
                  var ret = Math.floor(data * 100) / 100;
                  var ret = addCommas(ret);
                  return ret;
                }
              },
              {
                data: "out_value",
                className: "text-center",
                "render": function (data, type, row, meta) {
                  var ret = Math.floor(data * 100) / 100;
                  return addCommas(ret);;
                }
              },
              {
                data: "out_value_H001",
                className: "text-center",
                "render": function (data, type, row, meta) {
                  var ret = Math.floor(data * 100) / 100;

                  return addCommas(ret);
                }
              },
              {
                data: "total",
                className: "text-center",
              },
            ],
            dom:
              "<'row'<'col-md-5'B><'col-md-7 text-right col-flt-page'lf>>" +
              "<'row'<'col-md-12'tr>>" +
              "<'row'<'col-md-5 text-left'i><'col-sm-7 text-right'p>>",
            buttons: [
              {
                extend: "print",
                text: "<i class='fa fa-print'></i>&nbsp;Print",
                title: "",
              },
              {
                extend: "excel",
                footer: true,
                text: "<i class='fa fa-file-excel'></i>&nbsp;Excel",
                title:
                  "รายงานของที่นำเข้าเก็บในคลังสินค้าทัณฑ์บนฯ" +
                  StartDate +
                  "_to_" +
                  EndDate,
              },
              {
                text: `<button type="button" class="btn btn-info">พิมพ์รายงานประจำปี</button>`,
                action: function (e, dt, node, config) {
                  var data = dt.rows().data().toArray();
                  printReport(newData, StartDate, EndDate);
                }
               },
            ],
            footerCallback: function (row, data, start, end, display) {
              var api = this.api(),
                data;
              var intVal = function (i) {
                return typeof i === "string"
                  ? i.replace(/[\$,]/g, "") * 1
                  : typeof i === "number"
                    ? i
                    : 0;
              };
              var totalKG = api
                .column(6)
                .data()
                .reduce(function (a, b) {
                  return intVal(a) + intVal(b);
                }, 0);
              var totalAmt = api
                .column(7)
                .data()
                .reduce(function (a, b) {
                  return intVal(a) + intVal(b);
                }, 0);
              var totalH001 = api
                .column(8)
                .data()
                .reduce(function (a, b) {
                  return intVal(a) + intVal(b);
                }, 0);

              $(api.column(3).footer()).html("<b>รวม</b>");
              $(api.column(6).footer()).html(addCommas(totalKG.toFixed(2)));
              $(api.column(7).footer()).html(addCommas(totalAmt.toFixed(2)));
              $(api.column(8).footer()).html(addCommas(totalH001.toFixed(2)));
            },
          });
          $("#tblReport").loading("stop");
          $("#btnSearch").html(OldHtml);
        },
        error: function (e) {
          $("#tblReport").loading("stop");
          $("#btnSearch").html(OldHtml);
          console.log("There was an error with your request...");
          console.log("error: " + JSON.stringify(e));
        },
      });
    }
  }

  $("#btnReport").click(function () {
    moment.locale("th");
    ReportPDF();
  });


  function btnSave(type) {
   
    var Year = $("#selYear").val();
    var Month = $("#selMonth").val();
    var Month2 = $("#selMonth2").val();

    // get first day of month and last day of month use moment.js
    var StartDate = moment(Year + "-" + Month + "-01").format("YYYY-MM-DD");
    var EndDate = moment(Year + "-" + Month2 + "-01")
      .endOf("month")
      .format("YYYY-MM-DD");

    var StartDate2 = '2023-01-01';
    var EndDate2 = moment(StartDate).subtract(1, 'months').endOf('month').format("YYYY-MM-DD");
    
    if (type == 2) {
       reportSummary(StartDate, EndDate, StartDate2, EndDate2,Year);
       return false;
    }

    $.ajax({
      type: "POST",
      url: "././module/RPT_STS_CUSTOM_MAINRPT_ACCT/data.php",
      dataType: "json",
      data: {
        load: "reportMovingPDF",
        StartDate: StartDate,
        EndDate: EndDate,
        StartDate2: StartDate2,
        EndDate2: EndDate2
      },
      success: function (data) {
        const data1 = data[0];
        const data2 = data[1];
        const data3 = data[2];
        const data4 = data[3];

        const totalRemainOld = data1[0].totremain;
        const totalValueOld = data1.reduce((total, item) => total + Number(item.value), 0).toFixed(2);
        const taxOld = data1.map((item) => Number(item.tax).toFixed(2));
        const totalTaxOld = taxOld.reduce((total, item) => total + Number(item), 0).toFixed(2);
        const totalRemain = data4[0].totremain;
        const totalValue = data4.reduce((total, item) => total + Number(item.value), 0).toFixed(2);
        const tax = data4.map((item) => Number(item.tax));
        const totalTax = tax.reduce((total, item) => total + Number(item.toFixed(2)), 0).toFixed(2);

        const totalH001 = data3.reduce((total, item) => total + Number(item.out_value_H001), 0).toFixed(2);

        const Weight = data2.reduce((total, item) => total + Number(item.weight_KG), 0).toFixed(2);
        const Value = data2.reduce((total, item) => total + Number(item.value), 0)

        const val = data2.map((item) => {
              let val5 = item.value * 0.05
              let val7 = (Number(item.value) + val5) * 0.07
              let totalVal = val5 + val7
              return {
                totalVal,
              }
        });
        const newTotalTaxIN = val.reduce((total, item) => total + Number(item.totalVal.toFixed(2)), 0)

        makePDF2(totalRemainOld, totalValueOld, totalTaxOld, totalRemain, totalValue, totalTax, totalH001, Weight, Value, newTotalTaxIN, StartDate, EndDate);

      },
      error: function (e) {
        console.log("There was an error with your request...");
        console.log("error: " + JSON.stringify(e));
        alert("ไม่สามารถดึงข้อมูลได้");
      },
    })
  }

  function reportSummary(StartDate, EndDate, StartDate2, EndDate2,Year) {
    $.ajax({
      type: "POST",
      url: "././module/RPT_STS_CUSTOM_MAINRPT_ACCT/data.php",
      dataType: "json",
      data: {
        load: "reportSummaryPDF",
        StartDate: StartDate,
        EndDate: EndDate,
        StartDate2: StartDate2,
        EndDate2: EndDate2
      },
      success: function (data) {
        const data1 = data[0];
        const data2 = data[1];
        const data3 = data[2];
        const data4 = data[3];
        const data5 = data[4];

        const totalValueOld = data1.reduce((total, item) => total + Number(item.value), 0).toFixed(2);
        const taxOld = data1.map((item) => Number(item.tax).toFixed(2));
        const totalTaxOld = taxOld.reduce((total, item) => total + Number(item), 0).toFixed(2);

        const totalValue = data5.reduce((total, item) => total + Number(item.value), 0).toFixed(2);
        const tax = data5.map((item) => Number(item.tax).toFixed(2));
        const totalTax = tax.reduce((total, item) => total + Number(item), 0).toFixed(2);

        const Weight = data2.reduce((total, item) => total + Number(item.weight_KG), 0).toFixed(2);
        const Value = data2.reduce((total, item) => total + Number(item.value), 0).toFixed(2);
        const data_IN = data2.length;

        const val = data2.map((item) => {
              let val5 = item.value * 0.05
              let val7 = (Number(item.value) + val5) * 0.07
              let totalVal = val5 + val7
              return {
                totalVal,
              }
        });
        const newTotalTaxIN = val.reduce((total, item) => total + Number(item.totalVal.toFixed(2)), 0)


        const data_OUT = data3.length;
        const Value_OUT = data3.reduce((total, item) => total + Number(item.value), 0).toFixed(2);

        const data_Scrap = data4.length;
        const totalValue_Scrap = data4.map((item) => Number(item.value)).reduce((total, item) => total + Number(item), 0).toFixed(2);
        const tax_out = data4.map((item) => {
          let val7 = item.value * 0.07
          return {
            val7: parseInt(val7)
          }
        });
     
        const totalTax_Scrap = tax_out.reduce((total, item) => total + Number(item.val7), 0).toFixed(2);

        makePDF3(totalValueOld, totalTaxOld, totalValue, totalTax, data_IN, Value, newTotalTaxIN, data_OUT, Value_OUT,data_Scrap,totalValue_Scrap, totalTax_Scrap, StartDate, EndDate,Year);

      },
      error: function (e) {
        console.log("There was an error with your request...");
        console.log("error: " + JSON.stringify(e));
        alert("ไม่สามารถดึงข้อมูลได้");
      },
    })
  }

  function ReportPDF() {
    var Year = $("#selYear").val();
    var Month = $("#selMonth").val();
    var Month2 = $("#selMonth2").val();

    // get first day of month and last day of month use moment.js
    var StartDate = moment(Year + "-" + Month + "-01").format("YYYY-MM-DD");
    var EndDate = moment(Year + "-" + Month2 + "-01")
      .endOf("month")
      .format("YYYY-MM-DD");
    $.ajax({
      type: "POST",
      url: "././module/RPT_STS_CUSTOM_MAINRPT_ACCT/data.php",
      dataType: "json",
      data: {
        load: "reportPDF",
        StartDate: StartDate,
        EndDate: EndDate,
      },
      success: function (data) {
        console.log(data);

        makePDF(data, StartDate, EndDate);
      },
      error: function (e) {
        console.log("There was an error with your request...");
        console.log("error: " + JSON.stringify(e));
      },
    })
  }

  function makePDF(newData, StartDate, EndDate) {

    pdfMake.fonts = {
      THSarabunNew: {
        normal: 'THSarabunNew.ttf',
        bold: 'THSarabunNew Bold.ttf',
        italics: 'THSarabunNew-Italic.ttf',
        bolditalics: 'THSarabunNew-BoldItalic.ttf'
      }
    };


    const data = []
    data.push([
      { text: `ลำดับที่`, fontSize: 10, alignment: 'center', style: 'header' },
      { text: "ชื่อวัตถุดิบ", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "รหัสวัตถุดิบ", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "หน่วย", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "คงเหลือรวม", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "จำนวนคงเหลือ", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "เลขที่ใบขนฯ/ใบขนฯ โอนย้าย", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "ประเภทรายการ", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "วันนำเข้า", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "วันเข้าคลังฯ", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "มูลค่า(บาท)", fontSize: 11, alignment: 'center', style: 'header', },
      { text: "อากรรวม", fontSize: 11, alignment: 'center', style: 'header', },
    ]);


    for (let i = 0; i < newData.length; i++) {
      const newValue = (Number(newData[i].value)).toFixed(2);
      const newTax = (Number(newData[i].tax)).toFixed(2);
      data.push([
        { text: `${i === 0 ? i + 1 : ''}`, fontSize: 11, alignment: 'center' },
        { text: `${i === 0 ? 'HOT ROLLED STEEL SHEET IN COIL' : ''}`, fontSize: 11, alignment: 'center' },
        { text: `${i === 0 ? 'H0001' : ''}`, fontSize: 11, alignment: 'center' },
        { text: `${i === 0 ? 'KGS' : ''}`, fontSize: 11, alignment: 'center' },
        { text: `${i === 0 ? addCommas(newData[i].totremain) : ''}`, fontSize: 11, alignment: 'center' },
        { text: `${addCommas(newData[i].remain)}`, fontSize: 11, alignment: 'center' },
        { text: `${newData[i].doc_no}`, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: `${moment(newData[i].date_in.date).format('DD.MM.YYYY')}`, fontSize: 11, alignment: 'center' },
        { text: `${moment(newData[i].date_stock.date).format('DD.MM.YYYY')}`, fontSize: 11, alignment: 'center' },
        { text: `${addCommas(newValue)}`, fontSize: 11, alignment: 'center' },
        { text: `${addCommas(newTax)}`, fontSize: 11, alignment: 'center' },
      ])

      if (i == newData.length - 1) {
        const valueFix = newData.map(item => Number(Number(item.value).toFixed(2)));
        const totalValue = valueFix.reduce((total, item) => total + Number(item), 0)
        const taxFixNumbers = newData.map(item => Number(Number(item.tax).toFixed(2)));
        const totalTax = taxFixNumbers.reduce((total, item) => total + Number(item), 0)
        data.push([
          { text: 'รวม', colSpan: 3, fontSize: 11, alignment: 'center', colSpan: 4 },
          { text: '', fontSize: 11, alignment: 'center' },
          { text: '', fontSize: 11, alignment: 'center' },
          { text: '', fontSize: 11, alignment: 'center' },
          { text: '', fontSize: 11, alignment: 'center' },
          { text: `${addCommas(newData[0].totremain)}`, fontSize: 11, alignment: 'center' },
          { text: '', fontSize: 11, alignment: 'center' },
          { text: '', fontSize: 11, alignment: 'center' },
          { text: '', fontSize: 11, alignment: 'center' },
          { text: '', fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalValue.toFixed(2))}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalTax.toFixed(2))}`, fontSize: 11, alignment: 'center' },
        ])
      }

    }


    var docDefinition = {
      pageSize: 'A4',
      pageOrientation: 'landscape',
      pageMargins: [10, 100, 50, 50],
      header: function (currentPage, pageCount, pageSize) {
        return {
          margin: [30, 10, 20, 10],
          stack: [
            { text: "SAHA THAI STEEL PIPE (PUBLIC) CO., LTD. ทะเบียน W0201100000023", fontSize: 16, bold: true, alignment: 'center', margin: [0, 10, 0, 0] },
            { text: "รายงานของคงเหลือประจำงวด", fontSize: 14, alignment: 'center', margin: [0, 0, 0, 0] },
            { text: `สำหรับงวดบัญชี ระหว่างวันที่ ${new Date(StartDate).toLocaleDateString("th-TH", { year: 'numeric', month: 'long', day: 'numeric' })} ถึง ${new Date(EndDate).toLocaleDateString("th-TH", { year: 'numeric', month: 'long', day: 'numeric' })}`, fontSize: 14, alignment: 'center', margin: [0, 0, 0, 0] },
          ]
        };
      },
      content: [
        {
          margin: [0, 0, 0, 0],
          columns: [
            {

              table: {
                widths: [20, 150, 40, 20, 60, 60, 100, 50, 40, 40, 65, 65],
                headerRows: 1,
                body: data,
              },
            },
          ],
        }
      ],
      defaultStyle: {
        font: 'THSarabunNew',
      },
    };

    pdfMake.createPdf(docDefinition).open()
  }

  function makePDF2(totalRemainOld, totalValueOld, totalTaxOld, totalRemain, totalValue, totalTax, totalH001, Weight, Value, newTotalTaxIN, StartDate, EndDate) {

    pdfMake.fonts = {
      THSarabunNew: {
        normal: 'THSarabunNew.ttf',
        bold: 'THSarabunNew Bold.ttf',
        italics: 'THSarabunNew-Italic.ttf',
        bolditalics: 'THSarabunNew-BoldItalic.ttf'
      }
    };


    const data = []
    data.push([
      { text: `ลำดับ`, fontSize: 10, alignment: 'center', style: 'header', rowSpan: 2 },
      { text: "ชื่อวัตถุดิบ", fontSize: 11, alignment: 'center', style: 'header', rowSpan: 2 },
      { text: "รหัส  วัตถุดิบ", fontSize: 11, alignment: 'center', style: 'header', rowSpan: 2 },
      { text: "หน่วย", fontSize: 11, alignment: 'center', style: 'header', rowSpan: 2 },
      { text: "ยอดยกมา", fontSize: 11, alignment: 'center', style: 'header', colSpan: 3 },
      {},
      {},
      { text: "นำเข้าคลังสินค้าทัณฑ์บนฯ", fontSize: 11, alignment: 'center', style: 'header', colSpan: 3 },
      {},
      {},
      { text: "ปริมาณนำ", fontSize: 11, alignment: 'center', style: 'header' },
      { text: "ยอดคงเหลือยกไป", fontSize: 11, alignment: 'center', style: 'header', colSpan: 3 },
      {},
      {}
    ],
      [
        {},
        {},
        {},
        {},
        { text: "ปริมาณ", fontSize: 11, alignment: 'center' },
        { text: "มูลค่า(บาท)", fontSize: 11, alignment: 'center' },
        { text: "ภาษีอากร", fontSize: 11, alignment: 'center' },
        { text: "ปริมาณ", fontSize: 11, alignment: 'center' },
        { text: "มูลค่า(บาท)", fontSize: 11, alignment: 'center' },
        { text: "ภาษีอากร", fontSize: 11, alignment: 'center' },
        { text: "ออกจากคลังฯ", fontSize: 11, alignment: 'center', margin: [7, 0, 0, 0] },
        { text: "ปริมาณ", fontSize: 11, alignment: 'center' },
        { text: "มูลค่า(บาท)", fontSize: 11, alignment: 'center' },
        { text: "ภาษีอากร", fontSize: 11, alignment: 'center' },
      ]
    );


    for (let i = 0; i <= 10; i++) {

      if (i == 0) {
        data.push([
          { text: `${i === 0 ? i + 1 : ''}`, fontSize: 11, alignment: 'center' },
          { text: `${i === 0 ? 'HOT ROLLED STEEL SHEET IN COIL' : ''}`, fontSize: 11, alignment: 'center' },
          { text: `${i === 0 ? 'H0001' : ''}`, fontSize: 11, alignment: 'center' },
          { text: `${i === 0 ? 'KGS' : ''}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalRemainOld)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalValueOld)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalTaxOld)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(Weight)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas((Value).toFixed(2))}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(newTotalTaxIN)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalH001)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalRemain)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalValue)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalTax)}`, fontSize: 11, alignment: 'center' },
        ])
      }

      data.push([
        { text: ` `, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
        { text: ``, fontSize: 11, alignment: 'center' },
      ])

      if (i == 10) {
        data.push([
          { text: `${i === 0 ? i + 1 : ''}`, fontSize: 11, alignment: 'center' },
          { text: `รวม`, fontSize: 11, alignment: 'center' },
          { text: `${i === 0 ? 'H0001' : ''}`, fontSize: 11, alignment: 'center' },
          { text: `${i === 0 ? 'KGS' : ''}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalRemainOld)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalValueOld)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalTaxOld)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(Weight)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas((Value).toFixed(2))}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(newTotalTaxIN)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalH001)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalRemain)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalValue)}`, fontSize: 11, alignment: 'center' },
          { text: `${addCommas(totalTax)}`, fontSize: 11, alignment: 'center' },
        ])
      }

    }


    var docDefinition = {
      pageSize: 'A4',
      pageOrientation: 'landscape',
      pageMargins: [10, 100, 50, 50],
      header: function (currentPage, pageCount, pageSize) {
        return {
          margin: [30, 10, 20, 10],
          stack: [
            { text: "SAHA THAI STEEL PIPE (PUBLIC) CO., LTD. ทะเบียน W0201100000023", fontSize: 16, bold: true, alignment: 'center', margin: [0, 10, 0, 0] },
            { text: "รายงานการเคลื่อนไหวของวัตถุดิบ", fontSize: 14, alignment: 'center', margin: [0, 0, 0, 0] },
            { text: `สำหรับงวดบัญชี ระหว่างวันที่ ${new Date(StartDate).toLocaleDateString("th-TH", { year: 'numeric', month: 'long', day: 'numeric' })} ถึง ${new Date(EndDate).toLocaleDateString("th-TH", { year: 'numeric', month: 'long', day: 'numeric' })}`, fontSize: 14, alignment: 'center', margin: [0, 0, 0, 0] },
          ]
        };
      },
      content: [
        {
          margin: [0, 0, 0, 0],
          columns: [
            {

              table: {
                widths: [15, 120, 25, 20, 50, 55, 50, 50, 50, 50, 50, 50, 60, 50],
                headerRows: 1,
                body: data,
              },
            },
          ],
        }
      ],
      defaultStyle: {
        font: 'THSarabunNew',
      },
    };

    pdfMake.createPdf(docDefinition).open()
  }

  function makePDF3(totalValueOld, totalTaxOld, totalValue, totalTax, data_IN, Value, newTotalTaxIN, data_OUT, Value_OUT,data_Scrap,totalValue_Scrap, totalTax_Scrap, StartDate, EndDate,Year) {

    pdfMake.fonts = {
      THSarabunNew: {
        normal: 'THSarabunNew.ttf',
        bold: 'THSarabunNew Bold.ttf',
        italics: 'THSarabunNew-Italic.ttf',
        bolditalics: 'THSarabunNew-BoldItalic.ttf'
      }
    };


   // how to cal 10% from totalTax

    const ten = (totalTax * 10) / 100;
    const tenPercent = parseFloat(ten).toFixed(2);
    const Out_Scrap = Number(Value_OUT) + Number(totalValue_Scrap);
    const totalOut_Scrap = parseFloat(Out_Scrap).toFixed(2);


    const data = []
    data.push([
      { text: `รายการ`, fontSize: 10, alignment: 'center', style: 'header' },
      { text: "มูลค่า", fontSize: 10, alignment: 'center', style: 'header' },
      { text: "ภาษีอากรรวม", fontSize: 10, alignment: 'center', style: 'header' },
    ]);


    for (let i = 0; i <= 40; i++) {

      if (i == 0) {
        data.push([
          { text: `1.วัตถุดิบคงเหลือต้นงวด`, fontSize: 8, alignment: 'left' },
          { text: `${addCommas(totalValueOld)}`, fontSize: 8, alignment: 'center' },
          { text: `${addCommas(totalTaxOld)}`, fontSize: 8, alignment: 'center' },
        ])
      }

      if (i == 1) {
        data.push([
          { text: `2.รายการนำวัตถุดิบเข้าคลังฯ`, fontSize: 8, alignment: 'left' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }

      if (i == 2) {
        data.push([
          { text: `2.1 นำเข้า		                                                                                                              จำนวน	${data_IN}	ฉบับ`, fontSize: 8, alignment: 'left', margin: [10, 0, 0, 0] },
          { text: `${addCommas(Value)}`, fontSize: 8, alignment: 'center' },
          { text: `${addCommas(newTotalTaxIN)}`, fontSize: 8, alignment: 'center' },
        ])
      }

      if (i == 3) {
        data.push([
          { text: `2.2 รับโอน`, fontSize: 8, alignment: 'left', margin: [10, 0, 0, 0] },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }

      if (i == 4) {
        data.push([
          { text: `- คลังฯ	                                                                                                               จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 5) {
        data.push([
          { text: ` - 19 ทวิ	                                                                                                           	จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 6) {
        data.push([
          { text: `- FZ	                                                                                                           	    จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 7) {
        data.push([
          { text: `- EPZ	                                                                                                           	   จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 8) {
        data.push([
          { text: `- BOI	                                                                                                           	   จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 9) {
        data.push([
          { text: `- อื่นๆ	                                                                                                           	   จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }

      if (i == 10) {
        data.push([
          { text: `รวมการนำวัตถุดิบเข้าคลังฯ ( รวม 2.1 - 2.2 )`, fontSize: 8, alignment: 'center' },
          { text: `${addCommas(Value)}`, fontSize: 8, alignment: 'center' },
          { text: `${addCommas(newTotalTaxIN)}`, fontSize: 8, alignment: 'center' },
        ])
      }

      if (i == 11) {
        data.push([
          { text: `3.รายการนำวัตถุดิบออกจากคลังฯ`, fontSize: 8, alignment: 'left' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }

      if (i == 12) {
        data.push([
          { text: `3.1 ส่งออก		                                                                                                              	จำนวน	${data_OUT}	ฉบับ`, fontSize: 8, alignment: 'left' },
          { text: `${addCommas(Value_OUT)}`, fontSize: 8, alignment: 'center' },
          { text: `-`, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 13) {
        data.push([
          { text: `3.2 โอนออก		                                                                                                                 จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'left' },
          { text: `-`, fontSize: 8, alignment: 'center' },
          { text: `-`, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 14) {
        data.push([
          { text: `3.3 ชำระภาษี		                                                                                                               จำนวน	${data_Scrap}	ฉบับ`, fontSize: 8, alignment: 'left' },
          { text: `${addCommas(totalValue_Scrap)}`, fontSize: 8, alignment: 'center' },
          { text: `${addCommas(totalTax_Scrap)}`, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 15) {
        data.push([
          { text: `3.4 ทำลาย		                                                                                                              	 จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'left' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 16) {
        data.push([
          { text: `3.5 บริจาก		                                                                                                              	 จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'left' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 17) {
        data.push([
          { text: `3.6 อื่นๆ		                                                                                                              		จำนวน	-	ฉบับ`, fontSize: 8, alignment: 'left' },
          { text: ``, fontSize: 8, alignment: 'center' },
          { text: ``, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 18) {
        data.push([
          { text: `รวมการนำวัตถุดิบออกจากคลังฯ ( รวม 3.1 - 3.6 )`, fontSize: 8, alignment: 'left' },
          { text: `${addCommas(totalOut_Scrap)}`, fontSize: 8, alignment: 'center' },
          { text: `${addCommas(totalTax_Scrap)}`, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 19) {
        data.push([
          { text: `รายการ`, fontSize: 8, alignment: 'center' },
          { text: `มูลค่า`, fontSize: 8, alignment: 'center' },
          { text: `ภาษีอากรรวม`, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 20) {
        data.push([
          { text: `4.วัตถุดิบคงเหลือปลายงวด`, fontSize: 8, alignment: 'left' },
          { text: `${addCommas(totalValue)}`, fontSize: 8, alignment: 'center' },
          { text: `${addCommas(totalTax)}`, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 21) {
        data.push([
          { text: `5.รายการปรับปรุงบัญชี`, fontSize: 9, alignment: 'left' },
          { text: `-`, fontSize: 9, alignment: 'center' },
          { text: `-`, fontSize: 9, alignment: 'center' },
        ])
      }
      if (i == 22) {
        data.push([
          { text: `6.วัตถุดิบคงเหลือปลายงวดหลังปรับปรุงบัญชี`, fontSize: 9, alignment: 'left' },
          { text: `${addCommas(totalValue)}`, fontSize: 8, alignment: 'center' },
          { text: `${addCommas(totalTax)}`, fontSize: 8, alignment: 'center' },
        ])
      }

      if (i == 23) {
        data.push([
          { border: [false, false, false, false], text: `1.2  กรมศุลกากรกำหนดให้วางประกัน 10 % ของค่าภาษีอากรวัตถุดิบคงเหลือปลายงวดเป็นจำนวน ${addCommas(tenPercent)} บาท`, fontSize: 10, alignment: 'left', colSpan: 3 },
        ])
      }

      if (i == 24) {
        data.push([
          { border: [false, false, false, false], text: `บริษัทฯ วางค้ำประกันไว้แล้วจำนวน 43,650,000.00 บาท ตามหลักทรัพย์ดังนี้`, fontSize: 10, alignment: 'left', colSpan: 3 },
        ])
      }
      if (i == 25) {
        data.push([
          { border: [false, false, false, false], text: `1.2.1 หนังสือธนาคารค้ำประกัน จำนวน 3 ฉบับ มูลค่า 43,650,000.00 บาท`, fontSize: 10, alignment: 'left', colSpan: 3 },
        ])
      }
      if (i == 26) {
        data.push([
          { border: [false, false, false, false], text: `1.2.2 อื่นๆ (ระบุหลักทรัพย์) จำนวน - ฉบับ มูลค่า    -    บาท`, fontSize: 10, alignment: 'left', colSpan: 3 },
        ])
      }
      if (i == 27) {
        data.push([
          { border: [false, false, false, false], text: `บริษัทฯ  ต้องวางหลักทรัพย์ค้ำประกันเพิ่มขึ้น/ลดลง  จำนวน                           -   บาท`, fontSize: 10, alignment: 'left', colSpan: 3 },
        ])
      }
      if (i == 28) {
        data.push([
          { border: [false, false, false, false], text: `1.3 วัตถุดิบดงเหลือเก็บไว้ในคลังฯ เกินกำหนด 2 ปี จำนวน - ฉบับ (ใบขนฯ) มูลค่ - บาท ค่าภาษีอากรรวม - บาท`, fontSize: 10, alignment: 'left', colSpan: 3 },
        ])
      }
      if (i == 29) {
        data.push([
          { border: [false, false, false, false], text: `\uf046 อยู่ระหว่างดำเนินการชำระค่าภาษีอากร`, fontSize: 10, alignment: 'left', colSpan: 3 },
        ])
      }
      if (i == 30) {
        data.push([
          { border: [false, false, false, false], text: `\uf046 ชำระค่าภาษีอากรเรียนร้อยแล้ว ตามใบเสร็จเลขที่….…….………`, fontSize: 10, alignment: 'left', colSpan: 3 },
        ])
      }
      if (i == 31) {
        data.push([
          { border: [false, false, false, false], text: `\uf046 อื่น ๆ ….….………………………………………………………….`, fontSize: 10, alignment: 'left', colSpan: 3 },
        ])
      }
      if (i == 32) {
        data.push([
          {
            border: [false, false, false, false], text: `2. รายงานเครื่องจักร ส่วนประกอบ และอุปกรณ์ประกอบของเครื่องจักร ที่ได้รับยกเว้นอากรตามประกาศกระทรวง การคลัง ที่ ศก. 1/2531 ข้อ 2.3.10 บริษัทฯ มีเครื่องจักรที่ได้รับยกเว้นภาษีอากร		
`, fontSize: 10, alignment: 'left', colSpan: 3
          },
        ])
      }
      if (i == 33) {
        data.push([
          { text: `รายการ`, fontSize: 10, alignment: 'center' },
          { text: `มูลค่า`, fontSize: 10, alignment: 'center' },
          { text: `ภาษีอากรรวม`, fontSize: 10, alignment: 'center' },
        ])
      }
      if (i == 34) {
        data.push([
          { text: `ยอดยกมา`, fontSize: 8, alignment: 'left' },
          { text: `-`, fontSize: 8, alignment: 'center' },
          { text: `-`, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 35) {
        data.push([
          { text: `นำเข้า    จำนวน …………ฉบับ`, fontSize: 8, alignment: 'left' },
          { text: `-`, fontSize: 8, alignment: 'center' },
          { text: `-`, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 36) {
        data.push([
          { text: `หัก รายการที่ได้รับอนุมัติให้ตัดออกจากบัญชี`, fontSize: 9, alignment: 'left' },
          { text: `-`, fontSize: 8, alignment: 'center' },
          { text: `-`, fontSize: 8, alignment: 'center' },
        ])
      }
      if (i == 37) {
        data.push([
          { text: `คงเหลือ`, fontSize: 8, alignment: 'left' },
          { text: `-`, fontSize: 8, alignment: 'center' },
          { text: `-`, fontSize: 8, alignment: 'center' },
        ])
      }

      if (i == 38) {
        data.push([
          {
            border: [false, false, false, false], text: `บริษัทฯ  ได้แนบแผ่น CD  ชนิดอ่านข้อมูลได้อย่างเดียว  ซึ่งบันทึกข้อมูลรายงานทุกประเภท มาพร้อมนี้แล้ว จึงเรียนมาเพื่อโปรดพิจารณา	
`, fontSize: 10, alignment: 'left', colSpan: 3, margin: [10, 0, 0, 0]
          },
        ])
      }

      if (i == 39) {
        data.push([
          { border: [false, false, false, false], text: `( นายยอดชาย  ลมลอย )`, fontSize: 10, alignment: 'center', colSpan: 3, margin: [0, 0, 0, 0] },
        ])
      }

      if (i == 40) {
        data.push([
          { border: [false, false, false, false], text: `ผู้จัดการ`, fontSize: 10, alignment: 'center', colSpan: 3, margin: [0, 0, 0, 0] },
        ])
      }


    }
    

    var docDefinition = {
      pageSize: 'A4',
      pageMargins: [15, 100, 50, 50],
      header: function (currentPage, pageCount, pageSize) {
        return {
          margin: [30, 5, 20, 10],
          stack: [
            { text: `${new Date().toLocaleDateString("th-TH", { year: 'numeric', month: 'long', day: 'numeric' })}`, fontSize: 12, bold: true, alignment: 'right', margin: [0, 0, 0, 0] },
            { text: "เรียน  ผู้อำนวยการส่วนตรวจสอบคลังสินค้าทัณฑ์บน", fontSize: 10, alignment: 'left', margin: [0, 0, 0, 0] },
            { text: `      ข้าพเจ้าบริษัท สหไทยสตีลไพพ์ จำกัด (มหาชน) เลขประจำตัวผู้เสียภาษีอากร 3271001394 ได้รับอนุมัติให้จัดตั้งคลังสินค้าทัณฑ์บนประเภทโรงผลิตสินค้า เพื่อทำการผลิตสินค้าประเภทท่อเหล็กชุบสังกะสีและ	\n ไม่ชุบสังกะสี เลขทะเบียนสิทธิประโยชน์ทางภาษีอากรเลขที่ W0201100000023 ตั้งอยู่ ณ เลขที่ 78 หมู่ 3 ต.บางหญ้าแพรก ถนนปู่เจ้าสมิงพราย อ.พระประแดง จ.สมุทรปราการ ขอยื่นแบบสรุปการใช้วัตถุดิบประจำงวด บัญชีที่ ${moment(StartDate).format('M') > 6 ? '2' : '1'}/${Number(Year) + 543}(ระหว่างวันที่ ${new Date(StartDate).toLocaleDateString("th-TH", { year: 'numeric', month: 'long', day: 'numeric' })} ถึง ${new Date(EndDate).toLocaleDateString("th-TH", { year: 'numeric', month: 'long', day: 'numeric' })}) มีรายละเอียดดังนี้`, fontSize: 10, alignment: 'left', margin: [0, 0, 0, 0] },
            { text: '1.รายงานการใช้วัตถุดิบ', fontSize: 10, bold: true, alignment: 'left', margin: [0, 0, 0, 0] },
            { text: '        1.1 รายละเอียดการใช้วัตถุดิบ', fontSize: 10, bold: true, alignment: 'left', margin: [10, 0, 0, 0] }
          ]
        };
      },
      content: [
        {
          margin: [0, 0, 0, 0],
          columns: [
            {

              table: {
                widths: [300, 120, 120],
                headerRows: 1,
                body: data,
              },
            },
          ],
        }
      ],
      defaultStyle: {
        font: 'THSarabunNew',
      },
    };

    pdfMake.createPdf(docDefinition).open()
  }

  function printReport(info, StartDate, EndDate) {

    console.log(info);
    
    // sort arr by date
    const newData = info.sort((a, b) => new Date(a.date_in.date) - new Date(b.date_in.date));
    
    pdfMake.fonts = {
        THSarabunNew: {
            normal: 'THSarabunNew.ttf',
            bold: 'THSarabunNew Bold.ttf',
            italics: 'THSarabunNew-Italic.ttf',
            bolditalics: 'THSarabunNew-BoldItalic.ttf'
        },
        Roboto: {
            normal: 'Roboto-Regular.ttf',
            bold: 'Roboto-Medium.ttf',
            italics: 'Roboto-Italic.ttf',
            bolditalics: 'Roboto-MediumItalic.ttf'
        }
    };

    const data = []
    data.push([
      { text: `ลำดับที่`, fontSize: 12, bold: true, alignment: 'center', style: 'header' },
      { text: "วันนำเข้า/ส่งออก", fontSize: 12,bold: true,  alignment: 'center', style: 'header' },
      { text: "วันนำเข้าคลังฯ", fontSize: 12,bold: true,  alignment: 'center', style: 'header' },
      { text: "เลขที่ใบขนฯ/ใบขนฯโอนย้าย", fontSize: 12,bold: true,  alignment: 'center', style: 'header' },
      { text: "ประเภทรายการ", fontSize: 12, bold: true, alignment: 'center', style: 'header' },
      { text: "ยอดยกมา", fontSize: 12, bold: true, alignment: 'center', style: 'header' },
      { text: "นำเข้า", fontSize: 12, bold: true, alignment: 'center', style: 'header' },
      { text: "ส่งออก", fontSize: 12,bold: true,  alignment: 'center', style: 'header' },
      { text: "ส่งออก", fontSize: 12,bold: true,  alignment: 'center', style: 'header' },
      { text: "ยอดคงเหลือ", fontSize: 12,bold: true,  alignment: 'center', style: 'header' },
    ])

    for (let i = 0; i < newData.length ; i++) {
      data.push([
        { text: i + 1, fontSize: 12, alignment: 'center' },
        { text: moment(newData[i].date_in.date).format('DD/MM/YYYY'), fontSize: 12, alignment: 'center' },
        { text: moment(newData[i]?.date_stock?.date).format('DD/MM/YYYY'), fontSize: 12, alignment: 'center' },
        { text: newData[i].doc_no, fontSize: 12, alignment: 'center' },
        { text: newData[i].doc_type, fontSize: 12, alignment: 'center' },
        { text: newData[i].accum > 0 ? addCommas(Math.floor(newData[i].accum * 100) / 100) : 0, fontSize: 12, alignment: 'center' },
        { text: newData[i].in_value > 0 ? addCommas(Math.floor(newData[i].in_value * 100) / 100) : 0, fontSize: 12, alignment: 'center' },
        { text: newData[i].out_value > 0 ? addCommas(Math.floor(newData[i].out_value * 100) / 100) : 0, fontSize: 12, alignment: 'center' },
        { text: newData[i].out_value_H001 > 0 ? addCommas((Math.floor(newData[i].out_value_H001 * 100) / 100).toFixed(2)) : 0, fontSize: 12, alignment: 'center' },
        { text: newData[i].total, fontSize: 12, alignment: 'center' },
      ],)

    if (i == newData.length - 1) {
        data.push([
        { text: 'รวม', fontSize: 12, bold: true, alignment: 'center', colSpan: 6 },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: addCommas(newData.reduce((total, item) => total + Number(item.in_value), 0).toFixed(2)), fontSize: 12, bold: true,alignment: 'center' },
        { text: addCommas(newData.reduce((total, item) => total + Number(item.out_value), 0).toFixed(2)), fontSize: 12,bold: true, alignment: 'center' },
        { text: addCommas(newData.reduce((total, item) => total + Number(item.out_value_H001), 0).toFixed(2)), bold: true,fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        ],)
      }

    }

    if (newData.length == 0) {
      for (let i = 0; i < 5; i++) {
        data.push([
        { text: ' ', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
        { text: '', fontSize: 12, alignment: 'center' },
      ])
      }
    }


    var docDefinition = {
      pageSize: 'A4',
      pageOrientation: 'landscape',
      pageMargins: [25, 90, 50, 50],
      header: function (currentPage, pageCount, pageSize) {
        return {
          margin: [20, 5, 20, 10],
          table: {
            widths: [800],
            body: [
            [
                {
                  border: [false, false, false, false],
                  fontSize: 16,
                  bold: true,
                  text: "SAHA THAI STEEL PIPE (PUBLIC) CO., LTD. ทะเบียน W0201100000023",
                  alignment: 'center',

                },
              ],
              [
                {
                  border: [false, false, false, false],
                  fontSize: 14,
                  text: "รายงานบัญชีแยกประเภท",
                  alignment: 'center',

                },
              ],
              [
                {
                  border: [false, false, false, false], text: `สำหรับงวดบัญชี ระหว่างวันที่ ${new Date(StartDate).toLocaleDateString("th-TH", { year: 'numeric', month: 'long', day: 'numeric' })} ถึง ${new Date(EndDate).toLocaleDateString("th-TH", { year: 'numeric', month: 'long', day: 'numeric' })}`, fontSize: 14, alignment: 'center', margin: [0, 0, 0, 0]
                },
              ],
            ],
          },
        };
      },
      content: [
        {
          margin: [0, 0, 0, 0],
          columns: [
            {

              table: {
                widths: [30, 60, 60, 90, 60,80,80,80,80,80],
                headerRows: 1,
                body: data,
              },
            },
          ],
        }
      ],
      defaultStyle: {
        font: 'THSarabunNew',
      },
    };

    pdfMake.createPdf(docDefinition).open()
  }

</script>